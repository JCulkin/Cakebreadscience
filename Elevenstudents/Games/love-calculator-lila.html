<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouse Runner - Platform Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        .game-container {
            width: 100%;
            max-width: 800px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin: 20px;
        }
        
        .game-header {
            background-color: #333;
            color: white;
            padding: 15px;
            text-align: center;
        }
        
        .game-header h1 {
            margin: 0;
            font-size: 24px;
        }
        
        .game-instructions {
            padding: 10px;
            background-color: #f5f5f5;
            text-align: center;
            font-size: 14px;
            color: #333;
        }
        
        .game-instructions p {
            margin: 5px 0;
        }
        
        .game-canvas {
            display: flex;
            justify-content: center;
            background-color: #222;
        }
        
        .restart-button {
            display: none;
            margin: 15px auto;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .restart-button:hover {
            background-color: #45a049;
        }
        
        @media (max-width: 600px) {
            .game-header h1 {
                font-size: 20px;
            }
            
            .game-instructions {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>üê≠ Mouse Runner</h1>
        </div>
        <div class="game-instructions">
            <p><strong>How to Play:</strong> Use arrow keys to move left/right, press SPACE or UP arrow to jump.</p>
            <p>Avoid the red spikes and don't fall off the platforms! How far can you go?</p>
        </div>
        <div class="game-canvas" id="game-canvas"></div>
        <button class="restart-button" id="restart-button">Restart Now</button>
    </div>

    <script>
        let player;
        let platforms = [];
        let obstacles = [];
        let gravity = 0.8;
        let camX = 0;
        let gameOver = false;
        let highScore = 0;
        let deathTime = 0; // timestamp when player dies
        let restartDelay = 5000; // 5 seconds in milliseconds
        let restartButton;

        function setup() {
            let canvas = createCanvas(800, 400);
            canvas.parent('game-canvas');
            
            player = new Player(100, 300, 50, 50);
            
            restartButton = document.getElementById('restart-button');
            restartButton.addEventListener('click', function() {
                player = new Player(100, 300, 50, 50);
                startLevel();
                restartButton.style.display = 'none';
            });
            
            startLevel();
        }

        function startLevel() {
            platforms = [];
            obstacles = [];
            camX = 0;
            gameOver = false;
            deathTime = 0;
            
            // Safe starting platform
            platforms.push(new Platform(0, 350, 300, 20));
            
            // Generate platforms and spikes
            for (let i = 1; i < 150; i++) {
                let w = random(120, 220); // wider platforms
                let x = i * 220 + random(-20, 20); // more separated for spikes
                let y = random(280, 350); // lower platforms
                platforms.push(new Platform(x, y, w, 20));
                
                // Randomly add poisonous spike obstacles on some platforms
                if (random() < 0.35) {
                    let spikeX = x + random(0, w - 40);
                    let spikeY = y;
                    obstacles.push(new Obstacle(spikeX, spikeY, 40));
                }
            }
        }

        function draw() {
            if (gameOver) {
                // Pink background when dead
                background(255, 192, 203);

                // Countdown timer
                let elapsed = millis() - deathTime;
                let countdown = max(0, ceil((restartDelay - elapsed) / 1000));
                
                textAlign(CENTER, CENTER);
                textSize(48);
                fill(255, 0, 0);
                text("GAME OVER!!!", width/2, height/2 - 40);
                textSize(24);
                fill(0);
                text("Restarting in: " + countdown, width/2, height/2 + 20);
                
                // Show restart button
                restartButton.style.display = 'block';
                
                // Automatically restart after 5 seconds
                if (elapsed >= restartDelay) {
                    player = new Player(100, 300, 50, 50);
                    startLevel();
                    restartButton.style.display = 'none';
                }
                return;
            }

            background(20);

            push();
            translate(-camX, 0);

            // Draw platforms
            for (let plat of platforms) {
                plat.show();
            }

            // Draw obstacles
            for (let obs of obstacles) {
                obs.show();
            }
            
            player.update();
            player.show();
            
            pop();
            
            // Camera follows player
            if (player.x - camX > width * 0.7) camX = player.x - width * 0.7;
            if (player.x - camX < width * 0.3) camX = player.x - width * 0.3;

            // Check if player falls below the screen
            if (player.y > height) {
                triggerGameOver();
            }

            // Display high score and current distance at top-right corner
            fill(255);
            textSize(20);
            textAlign(RIGHT, TOP);
            let currentDistance = Math.floor(player.x);
            text("Distance: " + currentDistance + " px", width - 20, 20);
            text("High Score: " + highScore + " px", width - 20, 45);
        }

        function keyPressed() {
            if (!gameOver && (key === ' ' || keyCode === UP_ARROW)) {
                player.jump();
            }
        }

        // ---------------- Trigger Game Over ----------------
        function triggerGameOver() {
            gameOver = true;
            deathTime = millis();
            if (player.x > highScore) {
                highScore = Math.floor(player.x);
            }
        }

        // ---------------- Player ----------------
        class Player {
            constructor(x, y, w, h) {
                this.x = x;
                this.y = y;
                this.w = w;
                this.h = h;
                this.vy = 0;
                this.onGround = false;
            }

            update() {
                this.vy += gravity;
                this.y += this.vy;

                // Collision with platforms
                this.onGround = false;
                for (let plat of platforms) {
                    if (this.y + this.h > plat.y &&
                        this.y + this.h < plat.y + plat.h &&
                        this.x + this.w > plat.x &&
                        this.x < plat.x + plat.w &&
                        this.vy >= 0) {
                        this.y = plat.y - this.h;
                        this.vy = 0;
                        this.onGround = true;
                    }
                }

                // Collision with poisonous spikes
                for (let obs of obstacles) {
                    if (this.x + this.w > obs.x && this.x < obs.x + obs.size &&
                        this.y + this.h > obs.y - obs.size && this.y < obs.y + obs.size) {
                        triggerGameOver();
                    }
                }

                // Move left/right
                if (keyIsDown(LEFT_ARROW)) this.x -= 5;
                if (keyIsDown(RIGHT_ARROW)) this.x += 5;
            }

            jump() {
                if (this.onGround) this.vy = -15;
            }

            show() {
                push();
                translate(this.x + this.w/2, this.y + this.h/2);

                // Mouse body
                fill(180);
                ellipse(0, 0, this.w, this.h);
                fill(200);
                ellipse(-15, -15, 15, 15);
                ellipse(15, -15, 15, 15);
                fill(0);
                ellipse(-8, -5, 5, 5);
                ellipse(8, -5, 5, 5);
                fill(255,100,100);
                ellipse(0,5,5,5);

                pop();
            }
        }

        // ---------------- Platform ----------------
        class Platform {
            constructor(x, y, w, h) {
                this.x = x;
                this.y = y;
                this.w = w;
                this.h = h;
            }

            show() {
                noStroke();
                fill(random(100,255), random(100,255), 255);
                rect(this.x, this.y, this.w, this.h, 5);
            }
        }

        // ---------------- Obstacle (Poisonous Spike) ----------------
        class Obstacle {
            constructor(x, y, size) {
                this.x = x;
                this.y = y;
                this.size = size;
            }

            show() {
                // Draw spike base rectangle
                fill(150,0,0);
                rect(this.x, this.y, this.size, 10);

                // Draw poisonous triangle spikes
                fill(255,0,0);
                let spikeCount = 3;
                let spikeWidth = this.size / spikeCount;
                for (let i=0; i<spikeCount; i++) {
                    triangle(this.x + i*spikeWidth, this.y,
                            this.x + (i+1)*spikeWidth, this.y,
                            this.x + i*spikeWidth + spikeWidth/2, this.y - spikeWidth);
                }
            }
        }
    </script>
</body>
</html>