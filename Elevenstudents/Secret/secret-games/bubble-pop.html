<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bubble Pop</title>
  <style>
    html,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden;font-family:Courier New,monospace;background:#050814;color:#0f0}
    body{display:flex;align-items:center;justify-content:center;flex-direction:column}
    canvas{background:#071024;border:2px solid #0f0;border-radius:6px;display:block}
    .ui{position:absolute;left:8px;top:8px;font-size:12px}
    a.back{color:#0f0;text-decoration:none}
  </style>
  </head>
<body>
  <canvas id="c"></canvas>
  <script>
    const cvs = document.getElementById('c');
    const ctx = cvs.getContext('2d');
    function resizeCanvas(){
      cvs.width = window.innerWidth - 20;
      cvs.height = window.innerHeight - 40;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    const bubbles = [];
    let score = 0;
    // chaos-controlled parameters
    let speedMultiplier = 1;
    let invertMouse = false;
    const scoreEl = document.createElement('div');
    scoreEl.style.position = 'fixed'; scoreEl.style.right = '18px'; scoreEl.style.top = '18px'; scoreEl.style.color = '#0f0'; scoreEl.style.fontFamily = 'Courier New, monospace'; scoreEl.style.fontSize = '16px'; scoreEl.textContent = 'Score: 0'; document.body.appendChild(scoreEl);

    function sendScore(){
      try{ parent.postMessage({type:'score', id:'bubble', score: score}, '*'); }catch(e){}
    }

    function rand(max){return Math.random()*max}
    function spawn(){
      bubbles.push({x:rand(cvs.width),y:cvs.height+20,r:10+rand(30),vy:(-1-rand(2)) * speedMultiplier,col:`hsl(${rand(360)},80%,60%)`} )
    }
    for(let i=0;i<6;i++) spawn();
    cvs.addEventListener('click', e=>{
      const rect = cvs.getBoundingClientRect();
      let x = e.clientX-rect.left, y = e.clientY-rect.top;
      if(invertMouse){ x = cvs.width - x; }
      for(let i=bubbles.length-1;i>=0;i--){
        const b=bubbles[i];
        const d=Math.hypot(b.x-x,b.y-y);
        if(d < b.r){ bubbles.splice(i,1); score++; scoreEl.textContent = 'Score: '+score; sendScore(); for(let j=0;j<3;j++) spawn(); break }
      }
    })
    function loop(){
      ctx.clearRect(0,0,cvs.width,cvs.height);
      if(Math.random()<0.02) spawn();
      for(let i=bubbles.length-1;i>=0;i--){
        const b=bubbles[i]; b.y+=b.vy; b.x += Math.sin(b.y/20)*0.5;
        ctx.beginPath(); ctx.fillStyle=b.col; ctx.globalAlpha=0.9; ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill(); ctx.closePath();
        if(b.y + b.r < -50) bubbles.splice(i,1);
      }
      ctx.globalAlpha=1; 
      requestAnimationFrame(loop);
    }
    loop();
    sendScore();

    // listen for chaos messages
    window.addEventListener('message', e=>{
      try{
        const d = e.data;
        if(d && d.type === 'chaos'){
          speedMultiplier = d.speedMultiplier || 1;
          invertMouse = !!d.invertMouse;
        }
        if(d && d.type === 'reset'){
          speedMultiplier = 1; invertMouse = false;
        }
      }catch(err){}
    });
  </script>
</body>
</html>
